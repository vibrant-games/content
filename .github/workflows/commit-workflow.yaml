name: commit-workflow
on: [push]
jobs:
  convert-yaml-to-html:
    runs-on: ubuntu-20.04
    steps:
      #
      # Checkout the content repository:
      #
      - uses: actions/checkout@v2
        with:
          path: content

      #
      # Checkout the source repository:
      #
      - uses: actions/checkout@v2
        with:
          repository: vibrant-games/source
          # The main branch:
          ref: refs/heads/main
          path: source
          # Private repos:
          # https://github.com/actions/checkout#Checkout-multiple-repos-private
          # https://github.com/vibrant-games/content/settings/secrets/actions
          token: ${{ secrets.REPO_SOURCE_READONLY }}

      #
      # Install pre-requisite commands and libraries:
      #
      - run: ./source/applications/install/install_tools_requirements.sh

      #
      # Convert all NPCs from YAML to HTML:
      #
      - run: ./source/applications/tools/npcs_yaml_to_html.sh ./content

      #
      # Commit the NPC HTML files to the content repository:
      #
      - uses: EndBug/add-and-commit@v7
        with:
          cwd: '.'
          add: 'content/npcs/html'
          author_name: GitHub Actions NPCs YAML-to-HTML
          author_email: jtienhaara@yahoo.com
          message: 'GitHub Actions NPCs YAML-to-HTML conversion'
          push: true
